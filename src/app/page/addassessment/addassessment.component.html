<!-- Button to Trigger Modal -->
<button
  type="button"
  class="btn btn-outline-primary"
  (click)="openSearchModal()"
>
  Search Driver
</button>

<!-- Driver Search Modal Component -->
<app-driversearch
  #driverSearchModal
  (driverSelected)="onDriverSelected($event)"
></app-driversearch>

<form [formGroup]="assessmentForm">
  <div class="mb-3">
    <label for="driverId" class="form-label">Selected Driver ID</label>
    <input
      type="text"
      id="driverId"
      formControlName="driverId"
      class="form-control"
      readonly
    />
  </div>
</form>

<form [formGroup]="assessmentForm">
  <div
    *ngFor="let category of categoriesArray.controls; let i = index"
    [formGroup]="$any(category)"
    class="border"
  >
    <div class="form-check">
      <input
        type="checkbox"
        class="form-check-input"
        [id]="'category' + i"
        formControlName="selected"
      />
      <label [for]="'category' + i" class="form-check-label">
        {{ categories[i].name }}
      </label>
    </div>

    <!-- Show assessments if the category is selected -->
    <div *ngIf="category.get('selected')?.value" class="mt-2">
      <table class="table table-bordered">
        <thead class="table-warning">
          <tr>
            <th>Assessment</th>
            <th>Initial Assessment</th>
            <th>Final Assessment</th>
          </tr>
        </thead>
        <tbody formArrayName="assessments">
          <tr
            *ngFor="
              let assessmentControl of getAssessments(category).controls;
              let j = index
            "
            [formGroup]="$any(assessmentControl)"
          >
            <td class="text-sm-end">
              {{ assessmentControl.get("name")?.value }}
            </td>
            <td>
              <div
                class="form-check form-check-inline"
                *ngFor="let score of [0, 1, 2, 3]; let idx = index"
              >
                <input
                  type="radio"
                  class="form-check-input"
                  [id]="'scoreInitial' + j + idx"
                  [value]="score"
                  formControlName="scoreInitial"
                />
                <label
                  [for]="'scoreInitial' + j + idx"
                  class="form-check-label"
                >
                  {{ score }}
                </label>
              </div>
            </td>
            <td>
              <div
                class="form-check form-check-inline"
                *ngFor="let score of [0, 1, 2, 3]; let idx = index"
              >
                <input
                  type="radio"
                  class="form-check-input"
                  [id]="'scoreFinal' + j + idx"
                  [value]="score"
                  formControlName="scoreFinal"
                />
                <label [for]="'scoreFinal' + j + idx" class="form-check-label">
                  {{ score }}
                </label>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</form>
