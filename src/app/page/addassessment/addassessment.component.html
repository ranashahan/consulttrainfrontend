<div class="container-fluid">
  <!-- Button to Trigger Modal -->

  <!-- Driver Search Modal Component -->
  <app-driversearch
    #driverSearchModal
    (driverSelected)="onDriverSelected($event)"
  ></app-driversearch>

  <div class="bg-success bg-opacity-50 fs-7 fw-medium mt-3">
    <h6 class="ms-3">Driver Information</h6>

    <form
      [formGroup]="formDriver"
      class="row row-cols-lg-auto g-3 align-items-end ms-1"
    >
      <div class="col-auto">
        <label class="label ms-1" for="inlineFormInputGroupid">Driver ID</label>
        <div class="input-group">
          <input
            type="text"
            class="form-control form-control-sm my-input"
            id="inlineFormInputGroupid"
            placeholder="122323"
            formControlName="id"
          />
        </div>
      </div>
      <div class="col-auto">
        <label class="label ms-1" for="inlineFormInputGroupname"
          >Driver Name</label
        >
        <div class="input-group">
          <input
            type="text"
            class="form-control form-control-sm"
            id="inlineFormInputGroupname"
            placeholder="Muhammad Ahmed"
            formControlName="name"
          />
        </div>
      </div>
      <div class="col-auto">
        <label class="label ms-1" for="inlineFormInputGroupNic"
          >Driver NIC</label
        >
        <div class="input-group">
          <input
            type="text"
            class="form-control form-control-sm"
            id="inlineFormInputGroupNic"
            placeholder="xxxxx-xxxxxxx-x"
            formControlName="nic"
          />
        </div>
      </div>
      <div class="col-auto">
        <label class="label ms-1" for="inlineFormInputGroupNICExpiry"
          >Driver NIC Expiry</label
        >
        <div class="input-group">
          <input
            type="text"
            class="form-control form-control-sm my-input"
            id="inlineFormInputGroupNICExpiry"
            placeholder="mm/dd/yyyy"
            formControlName="nicexpiry"
          />
        </div>
      </div>
      <div class="col-auto">
        <label class="label ms-1" for="inlineFormInputGroupDOB"
          >Driver DOB</label
        >
        <div class="input-group">
          <input
            type="text"
            class="form-control form-control-sm my-input"
            id="inlineFormInputGroupDOB"
            placeholder="mm/dd/yyyy"
            formControlName="dob"
          />
        </div>
      </div>
      <div class="col-auto">
        <label class="label ms-1" for="inlineFormInputGroupAGE"
          >Driver Age</label
        >
        <div class="input-group">
          <input
            type="text"
            class="form-control form-control-sm my-input"
            id="inlineFormInputGroupAGE"
            placeholder="22"
            formControlName="age"
          />
        </div>
      </div>
      <div class="col-auto">
        <label class="label ms-1" for="inlineFormInputGroupLicense"
          >License #</label
        >
        <div class="input-group">
          <input
            type="text"
            class="form-control form-control-sm"
            id="inlineFormInputGroupLicense"
            placeholder="AA-xxxxx"
            formControlName="licensenumber"
          />
        </div>
      </div>
      <div class="col-auto">
        <label class="label ms-1" for="inlineFormInputGroupdltype"
          >License Type</label
        >
        <div class="input-group">
          <select
            class="form-select form-select-sm"
            id="inlineFormInputGroupdltype"
            formControlName="licensetypeid"
          >
            @for (item of dltypes; track $index) {
            <option [value]="item.id">
              {{ item.name }}
            </option>
            }
          </select>
        </div>
      </div>
      <div class="col-auto">
        <label class="label ms-1" for="inlineFormInputGroupLicenseExpiry"
          >License Expiry</label
        >
        <div class="input-group">
          <input
            type="text"
            class="form-control form-control-sm my-input"
            id="inlineFormInputGroupLicenseExpiry"
            formControlName="licenseexpiry"
            placeholder="mm/dd/yyyy"
          />
        </div>
      </div>
      <div class="col-auto">
        <label class="label ms-1" for="inlineFormInputGroupPermit"
          >Permit #</label
        >
        <div class="input-group">
          <input
            type="text"
            class="form-control form-control-sm"
            id="inlineFormInputGroupPermit"
            placeholder="CONT-xxxx"
            formControlName="permitnumber"
          />
        </div>
      </div>
      <div class="col-auto">
        <label class="label ms-1" for="inlineFormInputGroupPermitExpiry"
          >Permit Expiry</label
        >
        <div class="input-group">
          <input
            type="text"
            class="form-control form-control-sm"
            id="inlineFormInputGroupPermitExpiry"
            formControlName="permitexpiry"
            placeholder="mm/dd/yyyy"
          />
        </div>
      </div>
      <div class="col-auto">
        <label class="label ms-1" for="inlineFormInputGroupBlood"
          >BloodGroup</label
        >
        <div class="input-group">
          <select
            class="form-select form-select-sm"
            id="inlineFormInputGroupBlood"
            formControlName="bloodgroupid"
          >
            @for (item of bloodgroups; track $index) {
            <option [value]="item.id">
              {{ item.name }}
            </option>
            }
          </select>
        </div>
      </div>
      <div class="col-auto">
        <label class="label ms-1" for="inlineFormInputGroupClient"
          >Clients</label
        >
        <div class="input-group">
          <input
            type="text"
            class="form-control form-control-sm"
            id="inlineFormInputGroupClient"
            placeholder="U.E.P."
            formControlName="clientnames"
          />
        </div>
      </div>
      <div class="col-auto">
        <label class="label ms-1" for="inlineFormInputGroupContractor"
          >Contractor</label
        >
        <div class="input-group">
          <select
            class="form-select form-select-sm"
            id="inlineFormInputGroupContractor"
            formControlName="contractorid"
          >
            @for (item of contractors; track $index) {
            <option [value]="item.id">
              {{ item.name }}
            </option>
            }
          </select>
        </div>
      </div>

      <div class="col-auto">
        <label class="label ms-1" for="inlineFormInputGroupvisual"
          >Visual</label
        >
        <div class="input-group">
          <select
            class="form-select form-select-sm"
            id="inlineFormInputGroupvisual"
            formControlName="visualid"
          >
            @for (item of visuals; track $index) {
            <option [value]="item.id">
              {{ item.name }}
            </option>
            }
          </select>
        </div>
      </div>
      <div class="col-auto">
        <button
          type="submit"
          class="btn btn-warning btn-sm"
          (click)="openSearchModal()"
        >
          <i class="fa-regular fa-circle-user me-1"></i>Select Driver
        </button>
      </div>
    </form>
    <hr />
  </div>
  <div class="bg-warning bg-opacity-25 fs-7 fw-medium">
    <form
      [formGroup]="formGeneral"
      class="row row-cols-lg-auto g-3 align-items-end ms-1"
    >
      <div class="col-auto">
        <label class="label ms-1" for="inlineFormInputGroupTrainer"
          >Trainer</label
        >
        <mat-form-field
          class="small w-50"
          appearance="outline"
          id="inlineFormInputGroupTrainer"
        >
          <mat-label style="font-size: 12px">Select Trainer</mat-label>
          <mat-select style="font-size: 12px" multiple formArrayName="trainer">
            @for (item of trainers; track item.id) {
            <mat-option style="font-size: 12px" [value]="item.id">
              {{ item.initials }} </mat-option
            >}
          </mat-select>
        </mat-form-field>
      </div>
      <div class="col-auto">
        <label class="label ms-1" for="inlineFormInputGroupResult"
          >Result</label
        >
        <div class="input-group">
          <select
            class="form-select form-select-sm"
            id="inlineFormInputGroupResult"
            formControlName="result"
          >
            <option *ngFor="let item of results" [value]="item.id">
              {{ item.name }}
            </option>
          </select>
        </div>
      </div>
      <div class="col-auto">
        <label class="label ms-1" for="inlineFormInputGroupLocation"
          >Location</label
        >
        <div class="input-group">
          <select
            class="form-select form-select-sm"
            id="inlineFormInputGroupLocation"
            formControlName="result"
          >
            <option *ngFor="let item of locations" [value]="item.id">
              {{ item.name }}
            </option>
          </select>
        </div>
      </div>
      <div class="col-auto">
        <label class="label ms-1" for="inlineFormInputGroupStage">Stage</label>
        <div class="input-group">
          <select
            class="form-select form-select-sm"
            id="inlineFormInputGroupStage"
            formControlName="result"
          >
            <option *ngFor="let item of stages" [value]="item.id">
              {{ item.name }}
            </option>
          </select>
        </div>
      </div>
      <div class="col-auto">
        <label class="label ms-1" for="inlineFormInputGroupTitle">Title</label>
        <div class="input-group">
          <select
            class="form-select form-select-sm"
            id="inlineFormInputGroupTitle"
            formControlName="result"
          >
            <option *ngFor="let item of titles" [value]="item.id">
              {{ item.name }}
            </option>
          </select>
        </div>
      </div>
      <div class="col-auto">
        <label class="label ms-1" for="inlineFormInputGroupVehicle"
          >Vehicle</label
        >
        <div class="input-group">
          <select
            class="form-select form-select-sm"
            id="inlineFormInputGroupVehicle"
            formControlName="result"
          >
            <option *ngFor="let item of vehicles" [value]="item.id">
              {{ item.name }}
            </option>
          </select>
        </div>
      </div>
    </form>
    <hr />
  </div>

  <form *ngIf="assessmentForm && categoriesArray" [formGroup]="assessmentForm">
    <div
      *ngFor="let category of categoriesArray.controls; let i = index"
      [formGroup]="$any(category)"
      class="border"
    >
      <div class="form-check bg-warning bg-opacity-50">
        <input
          type="checkbox"
          class="form-check-input"
          [id]="'category' + i"
          formControlName="selected"
        />
        <label [for]="'category' + i" class="form-check-label">
          {{ categories[i].name }}
        </label>
      </div>

      <!-- Show assessments if the category is selected -->
      <div *ngIf="category.get('selected')?.value" class="mt-2">
        <table
          class="table table-sm table-hover table-bordered table-responsive-md fs-7"
        >
          <thead class="table-warning">
            <tr>
              <th>Assessment</th>
              <th>Ini</th>
              <th>Initial Assessment</th>
              <th>Middle Assessment</th>
              <th>Final Assessment</th>
            </tr>
          </thead>
          <tbody class="table-group-divider" formArrayName="assessments">
            <tr
              *ngFor="
                let assessmentControl of getAssessments(category).controls;
                let j = index
              "
              [formGroup]="$any(assessmentControl)"
            >
              <td class="text-sm-end">
                {{ assessmentControl.get("name")?.value }}
              </td>
              <td class="text-sm-end" style="width: 30px">
                {{ categories[i].initials
                }}{{ assessmentControl.get("initials")?.value }}
              </td>
              <td style="width: 150px">
                <div
                  class="form-check form-check-inline radio-group"
                  *ngFor="let score of [0, 1, 2, 3]; let idx = index"
                >
                  <input
                    type="radio"
                    class="form-check-input"
                    [id]="'scoreInitial' + j + idx"
                    [value]="score"
                    formControlName="scoreInitial"
                  />
                  <label
                    [for]="'scoreInitial' + j + idx"
                    class="form-check-label"
                  >
                    {{ score }}
                  </label>
                </div>
              </td>
              <td style="width: 150px">
                <div
                  class="form-check form-check-inline radio-group"
                  *ngFor="let score of [0, 1, 2, 3]; let idx = index"
                >
                  <input
                    type="radio"
                    class="form-check-input"
                    [id]="'scoreMiddle' + j + idx"
                    [value]="score"
                    formControlName="scoreMiddle"
                  />
                  <label
                    [for]="'scoreInitial' + j + idx"
                    class="form-check-label"
                  >
                    {{ score }}
                  </label>
                </div>
              </td>
              <td style="width: 150px">
                <div
                  class="form-check form-check-inline radio-group"
                  *ngFor="let score of [0, 1, 2, 3]; let idx = index"
                >
                  <input
                    type="radio"
                    class="form-check-input"
                    [id]="'scoreFinal' + j + idx"
                    [value]="score"
                    formControlName="scoreFinal"
                  />
                  <label
                    [for]="'scoreFinal' + j + idx"
                    class="form-check-label"
                  >
                    {{ score }}
                  </label>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    <div>
      <button
        class="btn btn-outline-primary"
        type="submit"
        [disabled]="assessmentForm.invalid"
        (click)="createAssessment()"
      >
        Save
      </button>
    </div>
  </form>
</div>
